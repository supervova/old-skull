@scope (.popover) {

  /* ------------------------------------------------------------------------ */
  /* #region: BASE                                                            */
  /* ------------------------------------------------------------------------ */
  :scope {
    --popover-body-background: var(--color-bg);
    --popover-body-color: var(--color-text-02);
    --popover-body-offset: var(--dim-1);
    --popover-body-inset-inline-start: 0;
    --popover-body-padding-block: var(--dim-2);
    --popover-body-padding-inline: var(--padding-inline-md, var(--dim-2));
    --popover-body-radius: var(--radius-base);
    --popover-body-shadow: var(--shadow-z2);
    --popover-body-translate-inline: 0;
    --popover-body-translate-block: var(--popover-body-offset);
    --popover-body-width: var(--width-sm);
    --popover-layer: 40;
    --popover-max-inline: calc(100vw - var(--dim-2plus) * 2);

    position: relative;
    width: fit-content;
  }

  /* #endregion */

  /* ------------------------------------------------------------------------ */
  /* #region: BODY                                                            */
  /* ------------------------------------------------------------------------ */

  :scope::details-content {
    transition: content-visibility var(--duration-200) var(--easing-base);
    transition-behavior: allow-discrete;
  }

  .popover-body {
    background-color: var(--popover-body-background);
    border-radius: var(--popover-body-radius);
    box-shadow: var(--popover-body-shadow);
    color: var(--popover-body-color);
    display: flex;
    flex-direction: column;
    margin: 0;
    inset-inline-start: var(--popover-body-inset-inline-start);
    max-width: var(--popover-max-inline);
    opacity: 0;
    padding-block: var(--popover-body-padding-block);
    padding-inline: var(--popover-body-padding-inline);
    pointer-events: none;
    position: absolute;
    text-align: start;
    transition:
      opacity var(--duration-200) var(--easing-disappearance),
      translate var(--duration-200) var(--easing-disappearance);
    translate: var(--popover-body-translate-inline) var(--popover-body-translate-block);
    width: var(--popover-body-width);
    z-index: var(--popover-layer);
  }

  /* Initial state for opening animation */
  @starting-style {
    :scope[open] > .popover-body,
    :scope.is-open > .popover-body {
      --popover-body-translate-block: var(--popover-body-offset);
      opacity: 0;
    }
  }

  .popover-body:has(> .menu) {
    padding: 0;
  }

  /* Open state */
  :scope[open] .popover-body,
  :scope.is-open > .popover-body {
    --popover-body-translate-block: 0;
    opacity: 1;
    pointer-events: auto;
    transition:
      opacity var(--duration-200) var(--easing-appearance),
      translate var(--duration-200) var(--easing-appearance);
  }

  /* #endregion */

  /* ------------------------------------------------------------------------ */
  /* #region: SUMMARY / TRIGGER                                               */
  /* ------------------------------------------------------------------------ */

  summary,
  [data-role='popover-summary'] {
    cursor: pointer;
  }

  /* Chevron indicator */
  :scope.popover-chevron summary {
    align-items: center;
    display: flex;
  }

  :scope.popover-chevron summary::after {
    background-image: var(--icon-chevron-down);
    background-position: center;
    background-repeat: no-repeat;
    content: '';
    display: block;
    height: var(--dim-2);
    margin-inline-start: var(--dim-0plus);
    transition: rotate var(--duration-50) var(--easing-base);
    width: var(--dim-2);
  }

  :scope.popover-chevron[open] summary::after,
  :scope.popover-chevron.is-open summary::after {
    rotate: 180deg;
  }

  /* #endregion */
}

/* -------------------------------------------------------------------------- */
/* #region: LAYOUT MODIFIERS                                                  */
/* -------------------------------------------------------------------------- */

@scope (.popover) {

  /* Position above trigger */
  :scope.popover-up > .popover-body {
    --popover-body-translate-block: calc(var(--popover-body-offset) * -1);
    inset-block-end: 100%;
  }

  @starting-style {
    :scope.popover-up[open] > .popover-body,
    :scope.popover-up.is-open > .popover-body {
      --popover-body-translate-block: var(--popover-body-offset);
    }
  }

  :scope.popover-up[open] > .popover-body,
  :scope.popover-up.is-open > .popover-body {
    --popover-body-translate-block: 0;
  }

  /* Align to end (right in LTR) */
  :scope.popover-end > .popover-body {
    @media (--phone-l) {
      inset-inline: auto 0;
    }
  }

  /* Align body to center */
  :scope.popover-center > .popover-body {
    --popover-body-inset-inline-start: 50%;
    --popover-body-translate-inline: -50%;
  }

  :scope.phone\:popover-center > .popover-body {
    @media (--phone) {
      --popover-body-inset-inline-start: 50%;
      --popover-body-translate-inline: -50%;
    }
  }
}

/* #endregion */

/* -------------------------------------------------------------------------- */
/* #region: ANCHOR POSITIONING (PROGRESSIVE ENHANCEMENT)                      */
/* -------------------------------------------------------------------------- */

@scope (.popover) {
  @supports (anchor-name: --a) and (position-anchor: --a) {

    /* Declare the anchor on the trigger. Works for both <summary> and [data-role='popover-summary'] */
    summary,
    [data-role='popover-summary'] {
      anchor-name: --popover-anchor;
    }

    /* Attach the popover body to the trigger via anchor positioning.
       Default placement also sets inline alignment for modern browsers. */
     .popover-body {
       position-anchor: --popover-anchor;

      /* Default placement: below + start (logical inline start) */
      inset-area: bottom start;
    }

    /* Modifier: place above the trigger */
    :scope.popover-up > .popover-body {
      inset-area: top start;
    }

    /* Inline alignment: end (logical inline end) */
    :scope.popover-end > .popover-body {
      inset-area: bottom end;
    }

    /* Inline alignment: center */
    :scope.popover-center > .popover-body {
      inset-area: bottom center;
    }

    /* Combinations with "up" */
    :scope.popover-up.popover-end > .popover-body {
      inset-area: top end;
    }

    :scope.popover-up.popover-center > .popover-body {
      inset-area: top center;
    }

    /* Phone-only center variant */
    :scope.phone\:popover-center > .popover-body {
      @media (--phone) {
        inset-area: bottom center;
      }
    }
  }
}

/* #endregion */
